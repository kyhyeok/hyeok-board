# 조회수

## 조회수 설계 및 데이터 일관성
- `조회수`는 단순히 게시글이 조회된 총 횟수만 저장하면 되며, 내역을 별도로 기록하거나 파생 데이터를 관리할 필요 없음
- `비정규화된 단일 레코드`에 바로 저장해도 충분하다고 판단
- 데이터 일관성 면에서
  - 게시글/댓글/좋아요 수는 원볼 데이터 기반이므로 불일치 시 사용자가 인지할 수 있어 정확성이 매우 중요
  - 조회수는 내역을 따로 제공하지 않으므로 `불일치 발생 시 시용자 인지 가능성이 낮음`
- `조회수는 트래픽이 많고, 일관성 요구 수준이 상대적으로 낮으므로`
  - `On-Memory Database(메모리 DB)` 활용 등으로 관리 효율을 높일 수 있음

## Redis
- `In-memory 기반 고성능 NoSQL(키-값 저종사 데이터베이스)`
- 정해진 스키마 없이 다양한 자료구조(String, List, Set, Hash, Sorted Set 등) 지원
- `TTL 기능`으로 데이터의 자동 만료/삭제 가능
- `단일 스레드(Single Thread) 순차 처리`로 동시성 문제가 적음
- `데이터 백업(RDB, AOF)` 및 `클러스터 구성`으로 확장성, 고가용성 지원
### 대표 사용 사례
- `고성능 데이터 처리 및 캐시`: 메모리 기반의 빠른 속도를 활용해 DB 부하 감소
- `실시간 데이터 처리`: pub/sub 기능으로 실시간 메시지 전달
- `분산 환경`: Redis Cluster로 확장성과 장애 대응 강화


## 조회수 설계 – Redis와 데이터 영속성
- `조회수 데이터베이스로 Redis(In-memory DB)`
  - 고성능이지만 메모리는 휘발성이라 데이터 유실 위험이 있음
- `데이터 일관성이 덜 중요해도, 완전한 유실은 방지해야 하므로 일정 수준의 영속성 필요`
- Redis는 _AOF_(Append Only File)와 `RDB(Snapshot)` 방식으로 시크드 백업 지원
  - AOF: 모든 명령을 로그로 기록 후, 복구 시 순서대로 재실행
  - RDB: 주기적으로 데이터를 파일로 저장
- 추가로 `MySQL 등 기존 DB에 조회수 백업` 등 자체적인 보조 백업 체계도 구축 가능

## Docker를 이용한 Redis 환경 세팅
- docker run --name hyeok-board-redis -d -p 6379:6379 redis:7.4
  - --name hyeok-board-redis: 컨테이너 이름 지정
  - -d: 컨테이너 백그라운드 실행
  - -p 6379:6379: 호스트 포트와 redis 컨테이너 포트 6379 매핑

## 데이터베이스 생성 (백업용)
- create database article_view;

## 게시글 테이블 (article_view_count)
| 컬럼명        | 데이터 타입        | 설명 / 제약조건              |
|------------|---------------|------------------------|
| article_id | BIGINT        | Primary Key(Shard Key) |
| view_count | BIGINT        | 조회수                    |